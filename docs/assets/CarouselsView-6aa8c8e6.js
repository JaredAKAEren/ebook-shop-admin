import{N as B,_ as V,r as L,P as S,a as M,b as R}from"./naiveuiUtils-e008ad3e.js";import{_ as z,N as j}from"./ImageUpload.vue_vue_type_script_setup_true_lang-c8926e28.js";import{a5 as w,d as I,J as q,r as c,L as D,X as A,P as i,O as n,S as d,a6 as $,ab as T,Q as U,a7 as E,a8 as F,a9 as J,aa as K,h,K as Q,M as W,W as y,V as P,ad as X,ae as G}from"./index-24d23373.js";import{u as H}from"./composables-63986051.js";import"./Dropdown-637a77b4.js";const Y=r=>w.get("/admin/slides",{params:{current:r}}),Z=r=>w.post("/admin/slides",r),ee=r=>w.patch(`/admin/slides/${r}/status`),te=r=>w.delete(`/admin/slides/${r}`),ae=I({__name:"CreateCarousel",emits:["reloadCarouselList"],setup(r,{emit:b}){const k=q(),u=c(null),s=c({title:"",img:"",url:"",status:0}),m={title:[{required:!0,message:"请输入标题",trigger:"blur"}],url:[{required:!0,message:"请输入跳转链接",trigger:"blur"},{type:"url",message:"请输入正确的链接地址",trigger:["input","blur"]}],img:[{required:!0,message:"请上传图片"}]},_=async function(){var l;if(await((l=u.value)==null?void 0:l.validate(o=>{})),s.value.img==="uploading")return k.warning("上传中，请稍后"),!1;try{const o=await Z(s.value);(o==null?void 0:o.status)===201&&k.success("创建成功")}catch{return!1}s.value.title="",s.value.img="",s.value.url="",b("reloadCarouselList")},g=function(l){s.value.img=l};return(C,l)=>{const o=E,p=F,x=B,N=J,O=K;return D(),A(O,{preset:"dialog",title:"创建轮播图","positive-text":"创建","negative-text":"取消","positive-button-props":{type:"info"},"negative-button-props":{type:"info"},"show-icon":!1,"mask-closable":!1,"transform-origin":"center",onPositiveClick:_},{default:i(()=>[n(N,{class:"p-4",ref_key:"formRef",ref:u,model:s.value,rules:m,"label-placement":"left","label-width":"auto","show-require-mark":!1},{default:i(()=>[n(p,{path:"title",label:"标题"},{default:i(()=>[n(o,{value:s.value.title,"onUpdate:value":l[0]||(l[0]=e=>s.value.title=e),placeholder:"请输入标题","theme-overrides":d($),clearable:""},null,8,["value","theme-overrides"])]),_:1}),n(p,{path:"url",label:"跳转链接"},{default:i(()=>[n(o,{value:s.value.url,"onUpdate:value":l[1]||(l[1]=e=>s.value.url=e),placeholder:"请输入跳转链接","theme-overrides":d($),clearable:""},null,8,["value","theme-overrides"])]),_:1}),n(p,{path:"status",label:"状态"},{default:i(()=>[n(x,{value:s.value.status,"onUpdate:value":l[2]||(l[2]=e=>s.value.status=e),"checked-value":1,"unchecked-value":0,"theme-overrides":d(T)},{checked:i(()=>[U("启用")]),unchecked:i(()=>[U("禁用")]),_:1},8,["value","theme-overrides"])]),_:1}),n(p,{path:"img",label:"上传图片"},{default:i(()=>[n(z,{"max-image":1,onAfterUploadImage:g})]),_:1})]),_:1},8,["model"])]),_:1})}}}),se={class:"p-2 bg-gray-100 h-full flex flex-col box-border"},le={class:"bg-white p-2 mt-2 rounded flex flex-col flex-1"},ne={class:"flex justify-between items-center mb-2 px-4"},oe=y("h3",{class:"text-xl"},"轮播图列表",-1),re={class:"flex-1"},pe=I({__name:"CarouselsView",setup(r){const b=q(),k=H(),u=c(1),s=c(1),m=c(!1),_=c(!1),g=c([]),C=c([{title:"图片",key:"img_url",render(e){return h(j,{class:"p-2 w-32",src:e.img_url,showToolbarTooltip:!0})}},{title:"标题",key:"title"},{title:"跳转链接",key:"url",render(e){return h("a",{class:"text-blue-600 font-bold hover:underline",href:e.url,target:"_blank"},e.url)}},{title:"状态",key:"status",width:"8rem",render(e){return h(B,{size:"medium",rubberBand:!1,checkedValue:1,uncheckedValue:0,value:e.status,themeOverrides:T,onClick:()=>x(e.id)},{checked:()=>"启用",unchecked:()=>"禁用"})}},{title:"排序",key:"seq",sorter:(e,t)=>e.seq-t.seq,width:"6rem"},{title:"创建时间",key:"created_at"},{title:"操作",key:"option",render(e){return[h(P,{class:"mr-2",size:"small",type:"info",dashed:!0,strong:!0},{default:()=>"编辑"}),h(P,{size:"small",type:"error",dashed:!0,strong:!0,onClick:()=>N(e.id)},{default:()=>"删除"})]}}]);Q(()=>{l(u.value)});const l=async function(t){if(!m.value)try{m.value=!0;const a=await Y(t);m.value=!1,(a==null?void 0:a.status)===200&&(g.value=a.data.data,u.value=a.data.meta.pagination.current_page,s.value=a.data.meta.pagination.total_pages)}catch{m.value=!1}},o=function(){_.value=!0},p=function(t){l(t)},x=async function(t){try{const a=await ee(t);if((a==null?void 0:a.status)!==204)return;const f=g.value.find(v=>v.id===t);f!==void 0&&(f.status=f.status===0?1:0,b.success(`${f.status===1?"启用":"禁用"}成功`))}catch{}},N=function(t){k.warning({title:"警告",content:"你确定要删除吗？",positiveText:"确定",negativeText:"取消",maskClosable:!1,transformOrigin:"center",showIcon:!1,closeOnEsc:!1,negativeButtonProps:{type:"info"},positiveButtonProps:{type:"info"},onPositiveClick:()=>{O(t)}})},O=async function(t){try{const a=await te(t);if((a==null?void 0:a.status)!==204)return;b.success("删除成功"),l(u.value)}catch{l(u.value)}};return(e,t)=>{const a=M,f=R;return D(),W("main",se,[n(V,{title:"轮播图管理"}),y("div",le,[y("header",ne,[oe,n(d(P),{type:"info","render-icon":d(L)(d(S)),onClick:o},{default:i(()=>[U("新建")]),_:1},8,["render-icon"])]),y("div",re,[n(a,{class:"h-full",columns:C.value,data:g.value,loading:m.value,"theme-overrides":d(X),"flex-height":""},null,8,["columns","data","loading","theme-overrides"])]),n(f,{class:"mt-2 justify-center",page:u.value,"onUpdate:page":t[0]||(t[0]=v=>u.value=v),"page-count":s.value,"theme-overrides":d(G)},null,8,["page","page-count","theme-overrides"])]),n(ae,{show:_.value,"onUpdate:show":t[1]||(t[1]=v=>_.value=v),onReloadCarouselList:t[2]||(t[2]=v=>p(1))},null,8,["show"])])}}});export{pe as default};
