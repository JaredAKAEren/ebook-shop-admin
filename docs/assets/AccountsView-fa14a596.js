import{N as W,_ as X,r as G,P as H,a as Y,b as Z}from"./naiveuiUtils-e008ad3e.js";import{a5 as I,d as S,J as B,r as s,L as F,X as D,P as d,O as a,S as c,a6 as N,a7 as q,a8 as V,a9 as j,aa as Q,h as P,ab as ee,K as ae,M as te,W as C,Q as M,ac as ne,V as U,ad as le,ae as oe,af as se}from"./index-24d23373.js";import{N as re}from"./Avatar-3b9e9cb8.js";import"./Dropdown-637a77b4.js";function ue(m){return I.get("/admin/users",{params:m})}function ie(m){return I.post("/admin/users",m)}function ce(m){return I.patch(`/admin/users/${m}/lock`)}function de(m){return I.get(`/admin/users/${m}`)}function me(m,b){return I.put(`/admin/users/${m}`,b)}const ve=S({__name:"CreateAccount",emits:["reloadAccountList"],setup(m,{emit:b}){const g=B(),k=s(null),e=s({name:"",email:"",password:""}),p={name:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"input"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},h=async function(){var v;await((v=k.value)==null?void 0:v.validate(l=>{}));try{const l=await ie(e.value);(l==null?void 0:l.status)===201&&g.success("创建成功")}catch{return!1}e.value.name="",e.value.email="",e.value.password="",b("reloadAccountList")};return(r,v)=>{const l=q,f=V,y=j,w=Q;return F(),D(w,{preset:"dialog",title:"创建账号","positive-text":"创建","negative-text":"取消","positive-button-props":{type:"info"},"negative-button-props":{type:"info"},"show-icon":!1,"mask-closable":!1,"transform-origin":"center",onPositiveClick:h},{default:d(()=>[a(y,{class:"p-4",ref_key:"formRef",ref:k,model:e.value,rules:p},{default:d(()=>[a(f,{path:"name",label:"昵称"},{default:d(()=>[a(l,{value:e.value.name,"onUpdate:value":v[0]||(v[0]=n=>e.value.name=n),placeholder:"请输入昵称","theme-overrides":c(N),clearable:""},null,8,["value","theme-overrides"])]),_:1}),a(f,{path:"email",label:"邮箱"},{default:d(()=>[a(l,{value:e.value.email,"onUpdate:value":v[1]||(v[1]=n=>e.value.email=n),placeholder:"请输入邮箱","theme-overrides":c(N),clearable:""},null,8,["value","theme-overrides"])]),_:1}),a(f,{path:"password",label:"密码"},{default:d(()=>[a(l,{value:e.value.password,"onUpdate:value":v[2]||(v[2]=n=>e.value.password=n),placeholder:"请输入密码","theme-overrides":c(N),type:"password","show-password-on":"mousedown",clearable:""},null,8,["value","theme-overrides"])]),_:1})]),_:1},8,["model"])]),_:1})}}}),fe=S({__name:"UpdateAccount",props:{id:null},emits:["reloadAccountList"],setup(m,{emit:b}){const g=m,k=B(),e=s(!1),p=s(!0),h=s(null),r=s({name:"",email:""}),v={name:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"input"}]},l=async function(n){try{e.value=!0;const o=await de(n);e.value=!1,p.value=!1,(o==null?void 0:o.status)===200&&(r.value.name=o.data.name,r.value.email=o.data.email)}catch{e.value=!1}},f=async function(){var n;await((n=h.value)==null?void 0:n.validate(o=>{}));try{const o=await me(g.id,r.value);(o==null?void 0:o.status)===204&&k.success("更新成功")}catch{return!1}b("reloadAccountList")},y=function(){r.value.name="",r.value.email="",e.value=!1,p.value=!0};return(w,n)=>{const o=q,O=V,$=j,L=Q;return F(),D(L,{preset:"dialog",title:"编辑账号","positive-text":"更新","negative-text":"取消","positive-button-props":{type:"info",disabled:p.value},"negative-button-props":{type:"info"},"show-icon":!1,"mask-closable":!1,"transform-origin":"center",onAfterEnter:n[2]||(n[2]=A=>l(m.id)),onAfterLeave:y,onPositiveClick:f},{default:d(()=>[a($,{class:"p-4",ref_key:"formRef",ref:h,model:r.value,rules:v},{default:d(()=>[a(O,{path:"name",label:"昵称"},{default:d(()=>[a(o,{value:r.value.name,"onUpdate:value":n[0]||(n[0]=A=>r.value.name=A),placeholder:"请输入昵称","theme-overrides":c(N),loading:e.value,disabled:p.value,clearable:""},null,8,["value","theme-overrides","loading","disabled"])]),_:1}),a(O,{path:"email",label:"邮箱"},{default:d(()=>[a(o,{value:r.value.email,"onUpdate:value":n[1]||(n[1]=A=>r.value.email=A),placeholder:"请输入邮箱","theme-overrides":c(N),loading:e.value,disabled:p.value,clearable:""},null,8,["value","theme-overrides","loading","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["positive-button-props"])}}}),pe={class:"p-2 bg-gray-100 h-full flex flex-col box-border"},_e={class:"bg-white p-2 mt-2 rounded flex flex-col flex-1"},ge={class:"flex justify-between px-4"},he={class:"flex"},be={class:"flex flex-col flex-1"},ke={class:"flex justify-between items-center mb-2 px-4"},ye=C("h3",{class:"text-xl"},"用户列表",-1),we={class:"flex-1"},Oe=S({__name:"AccountsView",setup(m){const b=B(),g=s(1),k=s(1),e=s(!1),p=s(!1),h=s(!1),r=s(!1),v=s(0),l=s(""),f=s(""),y=s([]),w=s([{title:"头像",key:"avatar_url",render(u){return P(re,{round:!0,src:u.avatar_url,size:"medium"})}},{title:"姓名",key:"name"},{title:"邮箱",key:"email"},{title:"状态",key:"is_locked",render(u){return P(W,{size:"medium",value:u.is_locked!==1,rubberBand:!1,themeOverrides:ee,onClick:()=>A(u)},{checked:()=>"启用",unchecked:()=>"禁用"})}},{title:"创建时间",key:"created_at"},{title:"操作",key:"option",render(u){return P(U,{size:"small",type:"info",strong:!0,dashed:!0,onClick:()=>T(u)},{default:()=>"编辑"})}}]);ae(()=>{n({current:g.value})});const n=async function(t){if(!e.value){!l.value||(t.name=l.value),!f.value||(t.email=f.value),p.value=t.email!==void 0||t.name!==void 0;try{e.value=!0;const i=await ue(t);e.value=!1,(i==null?void 0:i.status)===200&&(y.value=i.data.data,g.value=i.data.meta.pagination.current_page,k.value=i.data.meta.pagination.total_pages)}catch{e.value=!1}}},o=function(t){n({current:t})},O=function(){e.value||l.value===""&&f.value===""||n({current:1})},$=function(){!p.value&&(e.value||l.value===""&&f.value==="")||(l.value="",f.value="",n({current:1}))},L=function(){h.value=!0},A=async function(t){if(t)try{const i=await ce(t.id);if((i==null?void 0:i.status)!==204)return;const x=y.value.find(R=>R.id===t.id);x&&(x.is_locked=x.is_locked===0?1:0,b.success(`${x.is_locked===0?"启用":"禁用"}成功`))}catch{}},T=function(t){v.value=t.id,r.value=!0},z=function(){l.value!==""||f.value!==""?O():n({current:1})};return(u,t)=>{const i=q,x=V,R=j,E=se,J=Y,K=Z;return F(),te("main",pe,[a(X,{title:"用户管理"}),C("div",_e,[C("header",ge,[a(R,{inline:"","show-feedback":!1,"label-placement":"left"},{default:d(()=>[a(x,{label:"姓名"},{default:d(()=>[a(i,{value:l.value,"onUpdate:value":t[0]||(t[0]=_=>l.value=_),"theme-overrides":c(N),placeholder:"请输入姓名",clearable:""},null,8,["value","theme-overrides"])]),_:1}),a(x,{label:"邮箱"},{default:d(()=>[a(i,{value:f.value,"onUpdate:value":t[1]||(t[1]=_=>f.value=_),"theme-overrides":c(N),placeholder:"请输入完整邮箱",clearable:""},null,8,["value","theme-overrides"])]),_:1})]),_:1}),C("div",he,[a(c(U),{class:"mr-4","theme-overrides":c(ne),onClick:$},{default:d(()=>[M("重置")]),_:1},8,["theme-overrides"]),a(c(U),{type:"info",onClick:O},{default:d(()=>[M("搜索")]),_:1})])]),a(E,{style:{margin:"0.875rem 0"}}),C("div",be,[C("header",ke,[ye,a(c(U),{type:"info","render-icon":c(G)(c(H)),onClick:L},{default:d(()=>[M(" 新建 ")]),_:1},8,["render-icon"])]),C("div",we,[a(J,{class:"h-full",columns:w.value,data:y.value,loading:e.value,"theme-overrides":c(le),"flex-height":""},null,8,["columns","data","loading","theme-overrides"])]),a(K,{class:"mt-2 justify-center",page:g.value,"onUpdate:page":[t[2]||(t[2]=_=>g.value=_),o],"page-count":k.value,"theme-overrides":c(oe)},null,8,["page","page-count","theme-overrides"])])]),a(ve,{show:h.value,"onUpdate:show":t[3]||(t[3]=_=>h.value=_),onReloadAccountList:z},null,8,["show"]),a(fe,{show:r.value,"onUpdate:show":t[4]||(t[4]=_=>r.value=_),id:v.value,onReloadAccountList:z},null,8,["show","id"])])}}});export{Oe as default};
